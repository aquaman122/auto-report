{
  "name": "ìŒì„± íšŒì˜ë¡ Wiki ìë™ ì €ì¥",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "voice-meeting-wiki",
        "options": {
          "rawBody": true
        }
      },
      "name": "ì›¹í›… íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "id": "webhook-trigger"
    },
    {
      "parameters": {
        "functionCode": "// ì—…ë¡œë“œëœ ë°ì´í„° ê²€ì¦ ë° ì •ë¦¬\nconst inputData = $input.first().json;\n\n// íŒŒì¼ ì •ë³´ í™•ì¸\nif (!inputData.audioFile && !inputData.file_path) {\n  throw new Error('ì˜¤ë””ì˜¤ íŒŒì¼ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤');\n}\n\n// ë©”íƒ€ë°ì´í„° ì„¤ì •\nconst metadata = {\n  audioFile: inputData.audioFile || inputData.file_path,\n  language: inputData.language || 'ko',\n  userId: inputData.userId || 'system',\n  wikiSpace: inputData.wikiSpace || 'MEETING_MINUTES',\n  timestamp: new Date().toISOString(),\n  workflowId: $workflow.id,\n  requestId: Date.now().toString()\n};\n\n// ë¡œê¹…\nconsole.log('ğŸ™ï¸ Wiki ìë™ ì €ì¥ ì›Œí¬í”Œë¡œìš° ì‹œì‘:', metadata);\n\nreturn [{ json: metadata }];"
      },
      "name": "ì…ë ¥ ê²€ì¦",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 300],
      "id": "validate-input"
    },
    {
      "parameters": {
        "url": "http://meeting-api:3000/api/audio/upload",
        "options": {
          "bodyContentType": "form-data",
          "timeout": 600000
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "audioFile",
              "value": "={{ $json.audioFile }}"
            },
            {
              "name": "language",
              "value": "={{ $json.language }}"
            },
            {
              "name": "format",
              "value": "wiki"
            }
          ]
        }
      },
      "name": "ìŒì„± íŒŒì¼ ì²˜ë¦¬",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [680, 300],
      "id": "process-audio"
    },
    {
      "parameters": {
        "functionCode": "// API ì‘ë‹µ ê²€ì¦ ë° Wikiìš© ë°ì´í„° í¬ë§·íŒ…\nconst response = $input.first().json;\nconst inputMetadata = $('ì…ë ¥ ê²€ì¦').first().json;\n\n// ì²˜ë¦¬ ì‹¤íŒ¨ í™•ì¸\nif (!response.success) {\n  const errorMsg = response.message || response.error || 'ìŒì„± ì²˜ë¦¬ ì‹¤íŒ¨';\n  console.error('âŒ ìŒì„± ì²˜ë¦¬ ì‹¤íŒ¨:', errorMsg);\n  throw new Error(`ìŒì„± ì²˜ë¦¬ ì‹¤íŒ¨: ${errorMsg}`);\n}\n\n// íšŒì˜ ë°ì´í„° ì¶”ì¶œ\nconst meetingData = {\n  // ê¸°ë³¸ ì •ë³´\n  meetingId: response.data.meeting_id,\n  audioFileId: response.data.audio_file_id,\n  processingTime: response.data.processing_time,\n  \n  // íšŒì˜ ë‚´ìš©\n  title: response.data.meeting?.meeting_title || 'íšŒì˜ë¡',\n  date: response.data.meeting?.meeting_date || new Date().toISOString().split('T')[0],\n  summary: response.data.summary || 'ìš”ì•½ ì—†ìŒ',\n  \n  // ì°¸ì„ì ë° ì•¡ì…˜ ì•„ì´í…œ\n  participants: response.data.participants || [],\n  actionItems: response.data.action_items || [],\n  agendas: response.data.agendas || [],\n  \n  // ë¬¸ì„œ ì •ë³´\n  documents: response.documents || {},\n  \n  // ë©”íƒ€ë°ì´í„°\n  metadata: inputMetadata,\n  processedAt: new Date().toISOString()\n};\n\n// ì•¡ì…˜ ì•„ì´í…œ ê°œìˆ˜ ê³„ì‚°\nmeetingData.actionItemCount = Array.isArray(meetingData.actionItems) ? meetingData.actionItems.length : 0;\n\nconsole.log('âœ… íšŒì˜ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ:', { \n  meetingId: meetingData.meetingId, \n  title: meetingData.title,\n  actionItems: meetingData.actionItemCount,\n  participants: Array.isArray(meetingData.participants) ? meetingData.participants.length : 0\n});\n\nreturn [{ json: meetingData }];"
      },
      "name": "íšŒì˜ ë°ì´í„° í¬ë§·íŒ…",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 300],
      "id": "format-meeting-data"
    },
    {
      "parameters": {
        "functionCode": "// Wikiìš© ë§ˆí¬ë‹¤ìš´ ì»¨í…ì¸  ìƒì„±\nconst data = $input.first().json;\n\n// ì œëª© ì •ë¦¬ (íŠ¹ìˆ˜ë¬¸ì ì œê±°)\nconst cleanTitle = data.title.replace(/[^a-zA-Z0-9ê°€-í£\\s]/g, '').substring(0, 50);\nconst wikiTitle = `íšŒì˜ë¡_${data.date}_${cleanTitle}`;\n\n// ì°¸ì„ì ì •ë³´ í¬ë§·íŒ…\nconst participantsText = Array.isArray(data.participants) && data.participants.length > 0 ?\n  data.participants.map(p => {\n    if (typeof p === 'object') {\n      return `- **${p.name || p}** ${p.department ? `(${p.department})` : ''} ${p.role_in_meeting ? `- ${p.role_in_meeting}` : ''}`;\n    }\n    return `- ${p}`;\n  }).join('\\n') :\n  'ì°¸ì„ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';\n\n// ì•ˆê±´ ì •ë³´ í¬ë§·íŒ…\nconst agendasText = Array.isArray(data.agendas) && data.agendas.length > 0 ?\n  data.agendas.map((agenda, index) => `\n### ${index + 1}. ${agenda.agenda_title || `ì•ˆê±´ ${index + 1}`}\n\n**ë…¼ì˜ ë‚´ìš©:**\n${agenda.discussion_content || 'ë…¼ì˜ ë‚´ìš© ì—†ìŒ'}\n\n**í•µì‹¬ í¬ì¸íŠ¸:**\n${Array.isArray(agenda.key_points) ? agenda.key_points.map(point => `- ${point}`).join('\\n') : 'ì—†ìŒ'}\n\n**ê²°ì • ì‚¬í•­:**\n${agenda.decisions ? (typeof agenda.decisions === 'object' ? JSON.stringify(agenda.decisions, null, 2) : agenda.decisions) : 'ì—†ìŒ'}\n\n**ë‹¤ìŒ ë‹¨ê³„:**\n${Array.isArray(agenda.next_steps) ? agenda.next_steps.map(step => `- ${step}`).join('\\n') : 'ì—†ìŒ'}\n`).join('\\n') :\n  'ì•ˆê±´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';\n\n// ì•¡ì…˜ ì•„ì´í…œ í¬ë§·íŒ…\nconst actionItemsText = data.actionItemCount > 0 ?\n  data.actionItems.map((item, index) => {\n    if (typeof item === 'object') {\n      return `${index + 1}. **${item.task_description || item.task || item}**\n   - ë‹´ë‹¹ì: ${item.assignee || 'ë¯¸ì •'}\n   - ë§ˆê°ì¼: ${item.deadline || 'ë¯¸ì •'}\n   - ìš°ì„ ìˆœìœ„: ${item.priority || 'ë³´í†µ'}\n   - ìƒíƒœ: ${item.status || 'ì§„í–‰ ì¤‘'}`;\n    }\n    return `${index + 1}. ${item}`;\n  }).join('\\n\\n') :\n  'ì•¡ì…˜ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.';\n\n// Wiki ë§ˆí¬ë‹¤ìš´ ìƒì„±\nconst wikiContent = `\n# ${cleanTitle}\n\n> ğŸ“… **íšŒì˜ ë‚ ì§œ**: ${data.date}  \n> â±ï¸ **ì²˜ë¦¬ ì‹œê°„**: ${data.processingTime || 'N/A'}ì´ˆ  \n> ğŸ†” **íšŒì˜ ID**: ${data.meetingId}  \n> ğŸ¤– **ìë™ ìƒì„±**: ${data.processedAt}\n\n---\n\n## ğŸ‘¥ ì°¸ì„ì\n${participantsText}\n\n---\n\n## ğŸ“ íšŒì˜ ìš”ì•½\n${data.summary}\n\n---\n\n## ğŸ“‹ ì£¼ìš” ì•ˆê±´\n${agendasText}\n\n---\n\n## âœ… ì•¡ì…˜ ì•„ì´í…œ (${data.actionItemCount}ê°œ)\n${actionItemsText}\n\n---\n\n## ğŸ“ ê´€ë ¨ ë¬¸ì„œ\n${Object.keys(data.documents || {}).length > 0 ? \n  Object.keys(data.documents).map(format => \n    `- [${format.toUpperCase()} íŒŒì¼ ë‹¤ìš´ë¡œë“œ](${data.documents[format].url || '#'})`\n  ).join('\\n') : \n  'ê´€ë ¨ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.'\n}\n\n---\n\n## ğŸ“Š íšŒì˜ í†µê³„\n- **ì´ ì°¸ì„ì**: ${Array.isArray(data.participants) ? data.participants.length : 0}ëª…\n- **ë…¼ì˜ëœ ì•ˆê±´**: ${Array.isArray(data.agendas) ? data.agendas.length : 0}ê°œ\n- **ì•¡ì…˜ ì•„ì´í…œ**: ${data.actionItemCount}ê°œ\n- **ì²˜ë¦¬ ì‹œê°„**: ${data.processingTime || 'N/A'}ì´ˆ\n\n---\n\n*ì´ ë¬¸ì„œëŠ” ìŒì„± íšŒì˜ë¡ ìë™í™” ì‹œìŠ¤í…œì— ì˜í•´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*  \n*ìƒì„± ì‹œê°„: ${new Date().toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' })}*\n`;\n\nconst wikiData = {\n  title: wikiTitle,\n  content: wikiContent,\n  space: data.metadata.wikiSpace || 'MEETING_MINUTES',\n  tags: ['íšŒì˜ë¡', 'ìë™ìƒì„±', data.date, `ì•¡ì…˜ì•„ì´í…œ${data.actionItemCount}ê°œ`],\n  meetingId: data.meetingId,\n  date: data.date,\n  summary: {\n    participantCount: Array.isArray(data.participants) ? data.participants.length : 0,\n    agendaCount: Array.isArray(data.agendas) ? data.agendas.length : 0,\n    actionItemCount: data.actionItemCount,\n    processingTime: data.processingTime\n  }\n};\n\nconsole.log('ğŸ“ Wiki ì»¨í…ì¸  ìƒì„± ì™„ë£Œ:', { \n  title: wikiData.title, \n  contentLength: wikiContent.length,\n  actionItems: wikiData.summary.actionItemCount\n});\n\nreturn [{ json: wikiData }];"
      },
      "name": "Wiki ì»¨í…ì¸  ìƒì„±",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1120, 300],
      "id": "create-wiki-content"
    },
    {
      "parameters": {
        "url": "{{ $vars.WIKI_BASE_URL }}/api/pages",
        "options": {
          "bodyContentType": "json",
          "timeout": 30000
        },
        "sendBody": true,
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer {{ $vars.WIKI_API_TOKEN }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $json.title }}"
            },
            {
              "name": "content",
              "value": "={{ $json.content }}"
            },
            {
              "name": "space",
              "value": "={{ $json.space }}"
            },
            {
              "name": "type",
              "value": "page"
            },
            {
              "name": "status",
              "value": "published"
            },
            {
              "name": "metadata",
              "value": "={{ JSON.stringify($json.summary) }}"
            }
          ]
        }
      },
      "name": "Wiki í˜ì´ì§€ ì €ì¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1340, 300],
      "id": "save-to-wiki"
    },
    {
      "parameters": {
        "functionCode": "// Wiki ì €ì¥ ê²°ê³¼ í™•ì¸ ë° ìµœì¢… ì™„ë£Œ ì²˜ë¦¬\nconst wikiResponse = $input.first().json;\nconst wikiData = $('Wiki ì»¨í…ì¸  ìƒì„±').first().json;\nconst meetingData = $('íšŒì˜ ë°ì´í„° í¬ë§·íŒ…').first().json;\n\n// Wiki ì €ì¥ ì„±ê³µ ì—¬ë¶€ í™•ì¸\nconst wikiSuccess = !!(wikiResponse.id || wikiResponse.pageId || wikiResponse.url || wikiResponse.key || wikiResponse._links);\n\n// Wiki URL ìƒì„±\nlet wikiUrl = null;\nif (wikiSuccess) {\n  wikiUrl = wikiResponse.url || \n           wikiResponse._links?.webui || \n           wikiResponse._links?.base + wikiResponse._links?.webui ||\n           `${process.env.WIKI_BASE_URL || 'https://your-wiki.com'}/pages/${wikiResponse.id || wikiResponse.pageId || wikiResponse.key}`;\n}\n\n// ìµœì¢… ê²°ê³¼ ìƒì„±\nconst finalResult = {\n  success: true,\n  message: 'ğŸ‰ ìŒì„± íšŒì˜ë¡ Wiki ìë™ ì €ì¥ ì™„ë£Œ!',\n  \n  // íšŒì˜ ì •ë³´\n  meeting: {\n    id: meetingData.meetingId,\n    title: wikiData.title,\n    date: wikiData.date,\n    processingTime: meetingData.processingTime\n  },\n  \n  // Wiki ì €ì¥ ê²°ê³¼\n  wiki: {\n    saved: wikiSuccess,\n    pageId: wikiResponse.id || wikiResponse.pageId || wikiResponse.key || null,\n    url: wikiUrl,\n    title: wikiResponse.title || wikiData.title,\n    space: wikiData.space,\n    error: wikiSuccess ? null : (wikiResponse.message || wikiResponse.error || wikiResponse.errors || 'Unknown error')\n  },\n  \n  // ìš”ì•½ í†µê³„\n  statistics: {\n    participants: wikiData.summary.participantCount,\n    agendas: wikiData.summary.agendaCount,\n    actionItems: wikiData.summary.actionItemCount,\n    processingTimeSeconds: wikiData.summary.processingTime\n  },\n  \n  // íƒ€ì„ìŠ¤íƒ¬í”„\n  timestamps: {\n    started: meetingData.metadata.timestamp,\n    processed: meetingData.processedAt,\n    completed: new Date().toISOString()\n  }\n};\n\n// ê²°ê³¼ì— ë”°ë¥¸ ë¡œê¹…\nif (wikiSuccess) {\n  console.log('âœ… Wiki ì €ì¥ ì„±ê³µ!', {\n    pageId: finalResult.wiki.pageId,\n    url: finalResult.wiki.url,\n    title: finalResult.wiki.title,\n    actionItems: finalResult.statistics.actionItems\n  });\n} else {\n  console.error('âŒ Wiki ì €ì¥ ì‹¤íŒ¨:', {\n    error: finalResult.wiki.error,\n    title: wikiData.title,\n    response: wikiResponse\n  });\n}\n\n// ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ ë¡œê·¸\nconsole.log('ğŸŠ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ:', {\n  meetingId: finalResult.meeting.id,\n  wikiSaved: finalResult.wiki.saved,\n  processingTime: finalResult.meeting.processingTime,\n  participants: finalResult.statistics.participants,\n  actionItems: finalResult.statistics.actionItems,\n  totalDuration: new Date(finalResult.timestamps.completed) - new Date(finalResult.timestamps.started)\n});\n\nreturn [{ json: finalResult }];"
      },
      "name": "ì™„ë£Œ ì²˜ë¦¬ ë° ê²°ê³¼ í™•ì¸",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [1560, 300],
      "id": "completion-handler"
    },
    {
      "parameters": {
        "functionCode": "// ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…\nconst error = $input.first();\nconst inputData = $('ì…ë ¥ ê²€ì¦').first()?.json || {};\n\n// ì—ëŸ¬ ì •ë³´ ìˆ˜ì§‘\nconst errorInfo = {\n  timestamp: new Date().toISOString(),\n  workflowId: $workflow.id,\n  requestId: inputData.requestId,\n  step: 'ì•Œ ìˆ˜ ì—†ìŒ',\n  error: {\n    message: error.message || error.json?.message || 'Unknown error',\n    type: error.name || 'WorkflowError',\n    details: error.json || error\n  },\n  input: inputData\n};\n\n// ì‹¤íŒ¨ ë‹¨ê³„ ì¶”ì •\nif (error.message?.includes('ì˜¤ë””ì˜¤') || error.message?.includes('ìŒì„±')) {\n  errorInfo.step = 'ìŒì„± ì²˜ë¦¬';\n} else if (error.message?.includes('íŒŒì¼')) {\n  errorInfo.step = 'íŒŒì¼ ê²€ì¦';\n} else if (error.message?.includes('Wiki') || error.message?.includes('ìœ„í‚¤')) {\n  errorInfo.step = 'Wiki ì €ì¥';\n} else if (error.message?.includes('ì»¨í…ì¸ ') || error.message?.includes('í¬ë§·')) {\n  errorInfo.step = 'ì»¨í…ì¸  ìƒì„±';\n}\n\n// ì—ëŸ¬ ë¡œê¹…\nconsole.error('ğŸš¨ Wiki ìë™í™” ì›Œí¬í”Œë¡œìš° ì‹¤íŒ¨:', errorInfo);\n\n// ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€ ìƒì„±\nconst userFriendlyError = {\n  success: false,\n  message: 'ìŒì„± íšŒì˜ë¡ Wiki ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',\n  error: {\n    step: errorInfo.step,\n    message: errorInfo.error.message,\n    timestamp: errorInfo.timestamp,\n    requestId: errorInfo.requestId\n  },\n  troubleshooting: {\n    'ìŒì„± ì²˜ë¦¬': 'ìŒì„± íŒŒì¼ í˜•ì‹ì´ë‚˜ í¬ê¸°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”',\n    'íŒŒì¼ ê²€ì¦': 'ì—…ë¡œë“œëœ íŒŒì¼ì´ ì˜¬ë°”ë¥¸ ì˜¤ë””ì˜¤ í˜•ì‹ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”',\n    'Wiki ì €ì¥': 'Wiki API í† í°ê³¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”',\n    'ì»¨í…ì¸  ìƒì„±': 'íšŒì˜ ë°ì´í„° í¬ë§·ì„ í™•ì¸í•´ì£¼ì„¸ìš”'\n  }[errorInfo.step] || 'ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”'\n};\n\nreturn [{ json: userFriendlyError }];"
      },
      "name": "ì—ëŸ¬ ì²˜ë¦¬",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [900, 500],
      "id": "error-handler"
    }
  ],
  "connections": {
    "ì›¹í›… íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ì…ë ¥ ê²€ì¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì…ë ¥ ê²€ì¦": {
      "main": [
        [
          {
            "node": "ìŒì„± íŒŒì¼ ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ìŒì„± íŒŒì¼ ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "íšŒì˜ ë°ì´í„° í¬ë§·íŒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "íšŒì˜ ë°ì´í„° í¬ë§·íŒ…": {
      "main": [
        [
          {
            "node": "Wiki ì»¨í…ì¸  ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wiki ì»¨í…ì¸  ìƒì„±": {
      "main": [
        [
          {
            "node": "Wiki í˜ì´ì§€ ì €ì¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wiki í˜ì´ì§€ ì €ì¥": {
      "main": [
        [
          {
            "node": "ì™„ë£Œ ì²˜ë¦¬ ë° ê²°ê³¼ í™•ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": ["voice", "meeting", "wiki", "automation"],
  "triggerCount": 1,
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "versionId": "2"
}